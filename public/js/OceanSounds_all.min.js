var audio;
function jInit(){
    audio = $("#audioPlayer");
    addEventHandlers();
}

function addEventHandlers(){
    $("a.load").click(loadAudio);
    $("a.start").click(startAudio);
    $("a.forward").click(forwardAudio);
    $("a.back").click(backAudio);
    $("a.pause").click(pauseAudio);
    $("a.stop").click(stopAudio);
    $("a.volume-up").click(volumeUp);
    $("a.volume-down").click(volumeDown);
    $("a.mute").click(toggleMuteAudio);
}

function loadAudio(){
    audio.bind("load",function(){ });
    audio.trigger('load');
}

function startAudio(){
    audio.trigger('play');
}

function pauseAudio(){
    audio.trigger('pause');
}

function stopAudio(){
    pauseAudio();
    audio.prop("currentTime",0);
}

function forwardAudio(){
    pauseAudio();
    audio.prop("currentTime",audio.prop("currentTime")+5);
    startAudio();
}

function backAudio(){
    pauseAudio();
    audio.prop("currentTime",audio.prop("currentTime")-5);
    startAudio();
}

function volumeUp(){
    console.log("volumeUp!");
    var volume = audio.prop("volume")+0.2;
    if(volume >1){
        volume = 1;
    }
    audio.prop("volume",volume);
}

function volumeDown(){
    console.log("volumeDown!");
    var volume = audio.prop("volume")-0.2;
    if(volume <0){
        volume = 0;
    }
    audio.prop("volume",volume);
}

function toggleMuteAudio(){
    audio.prop("muted",!audio.prop("muted"));
};
var audioDatabase = [
  { 
    "audioFilename": "164767__rucisko__ocean-waves_Coimbra_Portugal.mp3", 
    "locationName": "Figueria da Foz, Portugal", 
    "locationCountry": "Portugal",
    "rating": "5",
    "xpos": "20",
    "ypos": "63",
    "volumeAdj": 0
  },
  { 
    "audioFilename": "20140316-064528-Indonedia-SeaOfJava.mp3", 
    "locationName": "Indonesia, Java Sea", 
    "locationCountry": "Indonesia",
    "rating": "4",
    "xpos": "252",
    "ypos": "162",
    "volumeAdj": 0
  },
  { 
    "audioFilename": "166214__abcopen__southern-ocean__Warrnambool_Australia_Levys-Beach.mp3", 
    "locationName": "Levy's Beach, Warrnambool, Australia",
    "locationCountry": "Australia",
    "rating": "5",
    "xpos": "338",
    "ypos": "269",
    "volumeAdj": -2
  },
  { 
    "audioFilename": "68638__rocktopus__stream-ocean__Warrnambool_AU.mp3", 
    "locationName": "French Polynesia", 
    "locationCountry": "French Polynesia",
    "rating": "4",
    "xpos": "420",
    "ypos": "151",
    "volumeAdj": 0
  },
  { 
    "audioFilename": "OceanBeach-LandsEndwFogHorn.mp3", 
    "locationName": "Land\'s End, San Francisco CA, USA", 
    "locationCountry": "United States",
    "rating": "5",
    "xpos": "525",
    "ypos": "57",
    "volumeAdj": 0
  },
];

var getAudioDataObject = function(index)  {
  if(index>=0 && index<audioDatabase.length) {
    return audioDatabase;
  }
  alert("ERROR - Invalid audio object id.");
};

var getAudioData_audioFileName = function(index)  {
  var obj = getAudioDataObject(index);
  return obj.audioFilename;
};

var getAudioData_locationName = function(index)  {
  var obj = getAudioDataObject(index);
  return obj.locationName;
};

var getAudioData_rating = function(index)  {
  var obj = getAudioDataObject(index);
  return obj.rating;
};

var getAudioData_xpos = function(index)  {
  var obj = getAudioDataObject(index);
  return obj.xpos;
};

var getAudioData_ypos = function(index)  {
  var obj = getAudioDataObject(index);
  return obj.ypos;
};

var getDatabaseLength = function() {
  return audioDatabase.length;
};
;var currentSelection = 0;
var len = audioDatabase.length;

var drawPinsWithSelection = function( selected ) {
  console.log("drawPinsWithSelection - " + selected);

  $('#leftArrowButton').removeClass("disabled");
  $('#rightArrowButton').removeClass("disabled");

  if(selected===0){
    $('#leftArrowButton').addClass("disabled");
  } else if(selected===audioDatabase.length-1) {
    $('#rightArrowButton').addClass("disabled");
  }


  $("#pinId0").animate({
      position: 'relative',
      left: audioDatabase[selected].xpos + "px",
      top: audioDatabase[selected].ypos + "px",
      opacity: '1.00'
    }, 1000, "swing", function() {
        $( "#pinId0" ).html( "<div>" + audioDatabase[selected].locationCountry + "</div>" );
    });

  // var pin = document.getElementById('pinId0');
  // pin.style.position = 'relative';
  // pin.style.left = "" + audioDatabase[selected].xpos + "px";
  // pin.style.top = "" + audioDatabase[selected].ypos + "px";
  // // pin.src = '../images/pin3.png';

  console.log("Selected filename: " + audioDatabase[selected].audioFilename);
  $('#nowPlayingMsg2').html(audioDatabase[selected].locationName);

  $('#audioPlayer').attr('src', "audio/ocean/" + audioDatabase[selected].audioFilename);
  $('#audioPlayer').load();
};



var moveLeft = function() {
  console.log("moveLeft! currentSelection="+currentSelection);
  if ( currentSelection > 0 ) {
    currentSelection--;
  }
  drawPinsWithSelection( currentSelection );
};

var moveRight = function() {
  if ( currentSelection < len-1 ) {
    currentSelection++;
  }
  drawPinsWithSelection( currentSelection );
};

var muteToggle = function() {
  $('#muteButton').toggleClass("mutedMode");
  toggleMuteAudio();
};



// MAIN - ON.READY
$(document).ready(function (){
  jInit(); // Audio Player actions/listeners

  $('#leftArrowButton').click(function(){    
    moveLeft();
  });

  $('#rightArrowButton').click(function(){    
    moveRight();
  });

  $('#muteButton').click(function(){
    muteToggle();
  });

  // Listen for arrow keys
  $(document).keydown(function(e) {
    console.log("KEYDOWN!");
    switch(e.which) {
      case 37: // left
      console.log("left");
      moveLeft();
      break;

      case 38: // up
      console.log("volume up");
      muteToggle();
      break;

      case 39: // right
      console.log("right");
      moveRight();
      break;

      case 40: // down
      console.log("volume down");
      muteToggle();
      break;

      default: return; // exit this handler for other keys
    }
    // e.preventDefault(); // prevent the default action (scroll / move caret)
  });



  drawPinsWithSelection( 0 );
});



